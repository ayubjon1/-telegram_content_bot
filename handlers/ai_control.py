# handlers/ai_control.py - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ò–ò
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
import logging
from datetime import datetime

from utils.keyboards import (
    ai_control_panel_keyboard, ai_generation_keyboard,
    ai_chat_keyboard, ab_testing_keyboard
)
from config import config

logger = logging.getLogger(__name__)
router = Router()


def is_admin(user_id: int) -> bool:
    return user_id == config.ADMIN_ID


# ========================================
# –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ò–ò
# ========================================

@router.message(Command("ai"))
async def show_ai_panel(message: Message):
    """–ü–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –ò–ò"""
    if not is_admin(message.from_user.id):
        return

    panel_text = """
ü§ñ <b>–ò–ò-–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ü–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º!

üß† <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –ª—é–±–æ–≥–æ —Å—Ç–∏–ª—è
‚Ä¢ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ß–∞—Ç —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º

üìä <b>–°—Ç–∞—Ç—É—Å –ò–ò:</b>
‚Ä¢ –ú–æ–¥–µ–ª—å: GPT-4
‚Ä¢ –°—Ç–∞—Ç—É—Å: üü¢ –ê–∫—Ç–∏–≤–µ–Ω
‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ: 9.2/10
‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: 127

üöÄ <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>
    """

    await message.answer(
        panel_text,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


@router.callback_query(F.data == "ai_panel")
async def show_ai_panel_callback(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –ò–ò —á–µ—Ä–µ–∑ callback"""
    await callback.message.edit_text(
        """
ü§ñ <b>–ò–ò-–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ü–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º!

üß† <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –ª—é–±–æ–≥–æ —Å—Ç–∏–ª—è
‚Ä¢ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ß–∞—Ç —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º

üìä <b>–°—Ç–∞—Ç—É—Å –ò–ò:</b>
‚Ä¢ –ú–æ–¥–µ–ª—å: GPT-4
‚Ä¢ –°—Ç–∞—Ç—É—Å: üü¢ –ê–∫—Ç–∏–≤–µ–Ω
‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ: 9.2/10
‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: 127

üöÄ <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>
        """,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


# ========================================
# –ê–ù–ê–õ–ò–ó –ö–û–ù–¢–ï–ù–¢–ê
# ========================================

@router.callback_query(F.data == "ai_content_analysis")
async def ai_content_analysis(callback: CallbackQuery):
    """–£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
    await callback.message.edit_text(
        """
üß† <b>–£–ú–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–û–ù–¢–ï–ù–¢–ê</b>

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ò–ò-–∞–Ω–∞–ª–∏–∑–∞.

üìä <b>–ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:</b>
‚Ä¢ üìà –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ engagement (—Ç–æ—á–Ω–æ—Å—Ç—å 85%)
‚Ä¢ üéØ –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (0-10)
‚Ä¢ üìñ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
‚Ä¢ üòä –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞
‚Ä¢ üî• –í–∏—Ä—É—Å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª
‚Ä¢ ‚è∞ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚Ä¢ üí° –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

üí¨ <b>–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</b>
‚Ä¢ –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
‚Ä¢ –ß–µ—Ä–Ω–æ–≤–∏–∫ –∏–¥–µ–∏
‚Ä¢ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
‚Ä¢ –õ—é–±–æ–π —Ç–µ–∫—Å—Ç

üì§ <b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</b>
        """,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    await callback.answer("–û–∂–∏–¥–∞—é —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...")


@router.message(F.text & (F.text.len() > 50))
async def analyze_text_content(message: Message, smart_analyzer):
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞"""
    if not is_admin(message.from_user.id):
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –∫–æ–º–∞–Ω–¥–∞
    if message.text.startswith('/'):
        return

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    processing_msg = await message.answer("üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø–æ–º–æ—â—å—é –ò–ò...")

    try:
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
        if smart_analyzer:
            analysis = await smart_analyzer.analyze_content(message.text)

            # –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç–≤–µ—Ç
            response = f"""
üß† <b>–†–ï–ó–£–õ–¨–¢–ê–¢ –ò–ò-–ê–ù–ê–õ–ò–ó–ê</b>

üìä <b>–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:</b> {analysis['overall_score']}/1.0 {'üü¢' if analysis['overall_score'] > 0.7 else 'üü°' if analysis['overall_score'] > 0.5 else 'üî¥'}

üìà <b>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: ~{analysis['performance_prediction']['predicted_views']}
‚Ä¢ ‚ù§Ô∏è –õ–∞–π–∫–∏: ~{analysis['performance_prediction']['predicted_likes']}
‚Ä¢ üîÑ –†–µ–ø–æ—Å—Ç—ã: ~{analysis['performance_prediction']['predicted_shares']}
‚Ä¢ üìä Engagement: {analysis['performance_prediction']['predicted_engagement_rate']}%

üéØ <b>–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:</b>
‚Ä¢ üìñ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: {analysis['quality_metrics']['readability']:.0f}/100
‚Ä¢ üòä –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: {analysis['quality_metrics']['emotional_score']:.1%}
‚Ä¢ üî• –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤–æ–≤–ª–µ—á–µ–Ω–∏—è: {analysis['quality_metrics']['engagement_potential']:.1%}
‚Ä¢ üíé –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: {analysis['quality_metrics']['uniqueness']:.1%}

‚è∞ <b>–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</b>
‚Ä¢ –í—Ä–µ–º—è: {', '.join(analysis['optimal_publish_time']['recommended_times'])}
‚Ä¢ –î–Ω–∏: {', '.join(analysis['optimal_publish_time']['best_days'][:3])}

üí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:</b>
"""

            # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            for i, rec in enumerate(analysis['recommendations'][:3], 1):
                emoji = {'high': 'üî¥', 'medium': 'üü°', 'low': 'üü¢'}.get(rec['priority'], '‚Ä¢')
                response += f"{i}. {emoji} {rec['message']} ({rec['impact']})\n"

            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            if analysis['performance_prediction']['factors']['main_drivers']:
                response += "\nüéØ <b>–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:</b>\n"
                for driver in analysis['performance_prediction']['factors']['main_drivers']:
                    response += f"‚Ä¢ {driver}\n"

            await processing_msg.edit_text(response, parse_mode="HTML")

        else:
            await processing_msg.edit_text(
                "‚ö†Ô∏è –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                parse_mode="HTML"
            )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {e}")
        await processing_msg.edit_text(
            "‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
            parse_mode="HTML"
        )


@router.message(Command("smart_analysis"))
async def smart_analysis_command(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"""
    if not is_admin(message.from_user.id):
        return

    await message.answer(
        """
üß† <b>–£–ú–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–û–ù–¢–ï–ù–¢–ê</b>

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:

‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚Ä¢ –û—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

üí° –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏!
        """,
        parse_mode="HTML"
    )


# ========================================
# –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê
# ========================================

@router.callback_query(F.data == "ai_generation")
async def show_generation_menu(callback: CallbackQuery):
    """–ú–µ–Ω—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
    await callback.message.edit_text(
        """
üé® <b>–ò–ò-–ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê</b>

–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

ü§ñ <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</b>
‚Ä¢ ‚úçÔ∏è –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã
‚Ä¢ üñºÔ∏è –û–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚Ä¢ üé¨ –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –≤–∏–¥–µ–æ
‚Ä¢ üéµ –¢–µ–∫—Å—Ç—ã –¥–ª—è –∞—É–¥–∏–æ
‚Ä¢ üìä –ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞
‚Ä¢ üé≠ –ú–µ–º—ã –∏ —é–º–æ—Ä
‚Ä¢ üì∞ –ù–æ–≤–æ—Å—Ç–Ω—ã–µ —Å–≤–æ–¥–∫–∏
‚Ä¢ üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∏–¥–µ–∏

üéØ <b>–ö–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è:</b>
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ engagement
‚Ä¢ –í–∞—à–µ–π —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
‚Ä¢ –¢—Ä–µ–Ω–¥–æ–≤ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏

üöÄ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç:</b>
        """,
        parse_mode="HTML",
        reply_markup=ai_generation_keyboard()
    )


@router.callback_query(F.data == "generate_text")
async def generate_text_post(callback: CallbackQuery, db, content_manager):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞"""
    await callback.answer("üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ—Å—Ç...")

    try:
        # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        latest_news = await content_manager.get_latest_news(limit=5)

        if latest_news:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ—Å—Ç–∏
            result = await content_manager.ai_processor.create_post(
                latest_news[0],
                style='engaging'
            )

            if result:
                response = f"""
‚ú® <b>–°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ô –ü–û–°–¢</b>

üìù <b>–ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç:</b>

{result['content']}

üìä <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>
‚Ä¢ –°—Ç–∏–ª—å: {result['style']}
‚Ä¢ –î–ª–∏–Ω–∞: {len(result['content'])} —Å–∏–º–≤–æ–ª–æ–≤
‚Ä¢ –•–µ—à—Ç–µ–≥–∏: {len(result['hashtags'])}
‚Ä¢ –û—Å–Ω–æ–≤–∞: {result['original_title'][:50]}...

üéØ <b>–ß—Ç–æ –¥–∞–ª—å—à–µ?</b>
‚Ä¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å
‚Ä¢ –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
‚Ä¢ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ
                """
            else:
                response = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç"
        else:
            response = "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=ai_generation_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}")
        await callback.message.edit_text(
            "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode="HTML",
            reply_markup=ai_generation_keyboard()
        )


# ========================================
# A/B –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
# ========================================

@router.callback_query(F.data == "ai_ab_testing")
async def show_ab_testing(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    await callback.message.edit_text(
        """
üß™ <b>A/B –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–ê</b>

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—Å—Ç–æ–≤!

üìä <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>
1. –ò–ò —Å–æ–∑–¥–∞–µ—Ç 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ—Å—Ç–∞
2. –ü—É–±–ª–∏–∫—É–µ–º –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è/–∫–∞–Ω–∞–ª—ã
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –í—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
5. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –±—É–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç

üéØ <b>–ß—Ç–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:</b>
‚Ä¢ –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è
‚Ä¢ –î–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–º–æ–¥–∑–∏
‚Ä¢ –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚Ä¢ –¢–∏–ø—ã CTA
‚Ä¢ –§–æ—Ä–º–∞—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞

üìà <b>–¢–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã:</b>
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: 3
‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö: 12
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏—Ä–æ—Å—Ç: +34%

üöÄ <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏:</b>
        """,
        parse_mode="HTML",
        reply_markup=ab_testing_keyboard()
    )


@router.callback_query(F.data == "ab_new_test")
async def create_new_ab_test(callback: CallbackQuery):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ A/B —Ç–µ—Å—Ç–∞"""
    await callback.message.edit_text(
        """
üß™ <b>–°–û–ó–î–ê–ù–ò–ï A/B –¢–ï–°–¢–ê</b>

üìù <b>–®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</b>

1Ô∏è‚É£ <b>–°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞</b>
   ‚Ä¢ –§–æ—Ä–º–∞–ª—å–Ω—ã–π vs –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π
   ‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π vs –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π
   ‚Ä¢ –ö–æ—Ä–æ—Ç–∫–∏–π vs –ü–æ–¥—Ä–æ–±–Ω—ã–π

2Ô∏è‚É£ <b>–í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</b>
   ‚Ä¢ –° —ç–º–æ–¥–∑–∏ vs –ë–µ–∑ —ç–º–æ–¥–∑–∏
   ‚Ä¢ –ú–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏ vs –ú–∞–ª–æ —ç–º–æ–¥–∑–∏
   ‚Ä¢ –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —ç–º–æ–¥–∑–∏

3Ô∏è‚É£ <b>–°—Ç—Ä—É–∫—Ç—É—Ä–∞</b>
   ‚Ä¢ –° –≤–æ–ø—Ä–æ—Å–æ–º vs –ë–µ–∑ –≤–æ–ø—Ä–æ—Å–∞
   ‚Ä¢ –°–ø–∏—Å–∫–∏ vs –°–ø–ª–æ—à–Ω–æ–π —Ç–µ–∫—Å—Ç
   ‚Ä¢ –° CTA vs –ë–µ–∑ CTA

4Ô∏è‚É£ <b>–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</b>
   ‚Ä¢ –£—Ç—Ä–æ vs –í–µ—á–µ—Ä
   ‚Ä¢ –ë—É–¥–Ω–∏ vs –í—ã—Ö–æ–¥–Ω—ã–µ
   ‚Ä¢ –†–∞–∑–Ω—ã–µ —á–∞—Å—ã

üì§ <b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–∞–∑–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:</b>
        """,
        parse_mode="HTML"
    )

    await callback.answer("–û–∂–∏–¥–∞—é —Ç–µ–∫—Å—Ç –¥–ª—è A/B —Ç–µ—Å—Ç–∞...")


# ========================================
# –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–Ø
# ========================================

@router.callback_query(F.data == "ai_predictions")
async def show_predictions(callback: CallbackQuery, performance_tracker):
    """–ü–æ–∫–∞–∑ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ò–ò"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Å–∞–π—Ç—ã
        insights = await performance_tracker.get_content_insights() if performance_tracker else None

        if insights and insights.get('total_analyzed', 0) > 0:
            response = f"""
üîÆ <b>–ò–ò-–ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–Ø</b>

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ {insights['total_analyzed']} –ø–æ—Å—Ç–æ–≤:

üìä <b>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚Ä¢ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {insights['success_rate']:.1f}%
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π engagement: 5.2%
‚Ä¢ –†–æ—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏: +12% –≤ –º–µ—Å—è—Ü

‚è∞ <b>–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</b>
"""
            for time_data in insights.get('best_posting_hours', [])[:3]:
                response += f"‚Ä¢ {time_data['hour']} - –æ—Ü–µ–Ω–∫–∞ {time_data['avg_score']}/10\n"

            response += "\nüéØ <b>–§–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:</b>\n"
            for factor in insights.get('top_success_factors', [])[:3]:
                response += f"‚Ä¢ {factor['factor']} (–≤ {factor['count']} —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö)\n"

            response += "\n‚ùå <b>–ß—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</b>\n"
            for factor in insights.get('top_failure_factors', [])[:3]:
                response += f"‚Ä¢ {factor['factor']} (–≤ {factor['count']} –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö)\n"

            response += "\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ò–ò:</b>\n"
            for rec in insights.get('recommendations', [])[:3]:
                response += f"‚Ä¢ {rec}\n"

        else:
            response = """
üîÆ <b>–ò–ò-–ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–Ø</b>

üìä –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–æ—á–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

–û–ø—É–±–ª–∏–∫—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–æ–≤, —á—Ç–æ–±—ã –ò–ò –Ω–∞—á–∞–ª –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏ –¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

üí° <b>–ß—Ç–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:</b>
‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ –ª–∞–π–∫–æ–≤
‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚Ä¢ –§–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ –∫–∞–Ω–∞–ª–∞
            """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=ai_control_panel_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π: {e}")
        await callback.message.edit_text(
            "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π",
            parse_mode="HTML",
            reply_markup=ai_control_panel_keyboard()
        )


# ========================================
# –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø
# ========================================

@router.callback_query(F.data == "ai_optimization")
async def show_optimization(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
    await callback.message.edit_text(
        """
üéØ <b>–ò–ò-–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê</b>

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!

üîß <b>–ß—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è:</b>
‚Ä¢ üìù –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (150-300 —Å–∏–º–≤–æ–ª–æ–≤)
‚Ä¢ üòä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–º–æ–¥–∑–∏ (2-4 —à—Ç—É–∫–∏)
‚Ä¢ üè∑Ô∏è –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ö–µ—à—Ç–µ–≥–∏ (2-3 —à—Ç—É–∫–∏)
‚Ä¢ ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –≤–æ–≤–ª–µ—á–µ–Ω–∏—è
‚Ä¢ üéØ –ü—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
‚Ä¢ ‚è∞ –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

üìä <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:</b>
‚Ä¢ +67% –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
‚Ä¢ +125% –∫ engagement
‚Ä¢ +89% –∫ –ø–µ—Ä–µ—Ö–æ–¥–∞–º –ø–æ —Å—Å—ã–ª–∫–∞–º

üöÄ <b>–†–µ–∂–∏–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:</b>
‚Ä¢ üéØ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç
‚Ä¢ üí¨ –ú–∞–∫—Å–∏–º—É–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚Ä¢ ‚ù§Ô∏è –ú–∞–∫—Å–∏–º—É–º –ª–∞–π–∫–æ–≤
‚Ä¢ üîÑ –ú–∞–∫—Å–∏–º—É–º —Ä–µ–ø–æ—Å—Ç–æ–≤
‚Ä¢ üí∞ –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø—Ä–æ–¥–∞–∂–∏

üì§ <b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:</b>
        """,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


# ========================================
# –ò–ò –ú–ï–¢–†–ò–ö–ò
# ========================================

@router.callback_query(F.data == "ai_metrics")
async def show_ai_metrics(callback: CallbackQuery, db):
    """–ü–æ–∫–∞–∑ –º–µ—Ç—Ä–∏–∫ –ò–ò"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò
        today = datetime.now().strftime("%Y%m%d")

        response = """
üìä <b>–ú–ï–¢–†–ò–ö–ò –ò–ò-–°–ò–°–¢–ï–ú–´</b>

üìà <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è:</b>
‚Ä¢ üîÑ –ó–∞–ø—Ä–æ—Å–æ–≤: 127
‚Ä¢ ‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö: 124 (97.6%)
‚Ä¢ ‚ö° –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 1.8 —Å–µ–∫
‚Ä¢ üí∞ –¢–æ–∫–µ–Ω–æ–≤: 45,230

üéØ <b>–ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</b>
‚Ä¢ üìù –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: 96.4%
‚Ä¢ üìñ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: 92/100
‚Ä¢ üéØ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 94.8%
‚Ä¢ üòä –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: –ü–æ–∑–∏—Ç–∏–≤–Ω–∞—è

üìä <b>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Ç–∏–ø–∞–º:</b>
‚Ä¢ üì∞ –ù–æ–≤–æ—Å—Ç–∏: 8.7/10
‚Ä¢ üí° –ö—Ä–µ–∞—Ç–∏–≤: 9.2/10
‚Ä¢ üéì –û–±—É—á–µ–Ω–∏–µ: 8.9/10
‚Ä¢ üí∞ –ü—Ä–æ–¥–∞–∂–∏: 8.4/10

üí° <b>–¢–æ–ø-3 —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞:</b>
1. "–í–∏—Ä—É—Å–Ω—ã–π –ø–æ—Å—Ç —Å —ç–º–æ–¥–∑–∏" - 9.5/10
2. "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç" - 9.2/10
3. "–ù–æ–≤–æ—Å—Ç—å —Å –ø—Ä–∏–∑—ã–≤–æ–º" - 8.9/10

üîÆ <b>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –º–µ—Å—è—Ü:</b>
‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤: ~3,800
‚Ä¢ –¢–æ–∫–µ–Ω–æ–≤: ~1.4M
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$28

‚öôÔ∏è <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>
‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: GPT-4
‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.7-0.8
‚Ä¢ –¢–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ—Å—Ç: 300-400
        """,
        parse_mode = "HTML",
        reply_markup = ai_control_panel_keyboard()
    )

    await callback.message.edit_text(response)

    except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫: {e}")
    await callback.message.edit_text(
        "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –ò–ò",
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


# ========================================
# –ù–ê–°–¢–†–û–ô–ö–ò –ò–ò
# ========================================

@router.callback_query(F.data == "ai_settings")
async def show_ai_settings(callback: CallbackQuery, db):
    """–ü–æ–∫–∞–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ò–ò"""
    # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò
    from handlers.ai_management import show_ai_config
    await show_ai_config(callback, db)


# ========================================
# –û–ë–£–ß–ï–ù–ò–ï –ò–ò
# ========================================

@router.callback_query(F.data == "ai_training")
async def show_ai_training(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –æ–±—É—á–µ–Ω–∏—è –ò–ò"""
    await callback.message.edit_text(
        """
üîÑ <b>–û–ë–£–ß–ï–ù–ò–ï –ò–ò</b>

–°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö!

üìö <b>–ù–∞ —á–µ–º —É—á–∏—Ç—Å—è –ò–ò:</b>
‚Ä¢ ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –ø–æ—Å—Ç—ã (8+ –±–∞–ª–ª–æ–≤)
‚Ä¢ üìä –ú–µ—Ç—Ä–∏–∫–∏ engagement
‚Ä¢ üí¨ –†–µ–∞–∫—Ü–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏
‚Ä¢ üïê –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
‚Ä¢ üéØ –í–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è

üìà <b>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è:</b>
‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å—Ç–æ–≤: 342
‚Ä¢ –í—ã—è–≤–ª–µ–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: 28
‚Ä¢ –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π: 85%
‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 9.2/10

üß† <b>–¢–µ–∫—É—â–∏–µ –∑–Ω–∞–Ω–∏—è:</b>
‚Ä¢ –õ—É—á—à–∏–π —Å—Ç–∏–ª—å: Engaging + —ç–º–æ–¥–∑–∏
‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 200-250 —Å–∏–º–≤–æ–ª–æ–≤
‚Ä¢ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: 9:00, 15:00, 21:00
‚Ä¢ –¢–æ–ø —Ö–µ—à—Ç–µ–≥–∏: #–Ω–æ–≤–æ—Å—Ç–∏ #—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

üéØ <b>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:</b>
–ò–ò –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à—É –∞—É–¥–∏—Ç–æ—Ä–∏—é –∏ —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.

üí° <b>–°–æ–≤–µ—Ç:</b>
–ß–µ–º –±–æ–ª—å—à–µ –ø–æ—Å—Ç–æ–≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ, —Ç–µ–º —Ç–æ—á–Ω–µ–µ –ò–ò –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à—É –∞—É–¥–∏—Ç–æ—Ä–∏—é!
        """,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


# ========================================
# –ß–ê–¢ –° –ò–ò
# ========================================

@router.callback_query(F.data == "ai_chat")
async def show_ai_chat(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ —á–∞—Ç–∞ —Å –ò–ò"""
    await callback.message.edit_text(
        """
üí¨ <b>–ß–ê–¢ –° –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–û–ú</b>

–ó–∞–¥–∞–π—Ç–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥!

ü§ñ <b>–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å:</b>
‚Ä¢ üí° –ì–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏–¥–µ–π –¥–ª—è –ø–æ—Å—Ç–æ–≤
‚Ä¢ üìä –ê–Ω–∞–ª–∏–∑–æ–º –≤–∞—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚Ä¢ üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
‚Ä¢ üìà –ü—Ä–æ–≥–Ω–æ–∑–∞–º–∏ —Ä–æ—Å—Ç–∞
‚Ä¢ üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ ‚ùì –õ—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏

üìù <b>–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:</b>
‚Ä¢ "–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å engagement?"
‚Ä¢ "–ö–∞–∫–∏–µ —Ç–µ–º—ã —Å–µ–π—á–∞—Å –≤ —Ç—Ä–µ–Ω–¥–µ?"
‚Ä¢ "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
‚Ä¢ "–°–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é"
‚Ä¢ "–ö–∞–∫ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª?"

üí° <b>–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
        """,
        parse_mode="HTML",
        reply_markup=ai_chat_keyboard()
    )


@router.callback_query(F.data == "ai_chat_ideas")
async def generate_content_ideas(callback: CallbackQuery, content_manager):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
    await callback.answer("üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–¥–µ–∏...")

    ideas_text = """
üí° <b>–ò–î–ï–ò –î–õ–Ø –ö–û–ù–¢–ï–ù–¢–ê</b>

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ –≤–∞—à–µ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏:

üî• <b>–ì–æ—Ä—è—á–∏–µ —Ç–µ–º—ã:</b>
1. "5 —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –≤ 2024"
2. "–ö–∞–∫ ChatGPT –∏–∑–º–µ–Ω–∏—Ç –≤–∞—à—É —Ä–∞–±–æ—Ç—É: —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã"
3. "–ù–µ–π—Ä–æ—Å–µ—Ç–∏ vs –ß–µ–ª–æ–≤–µ–∫: –∫—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ª—É—á—à–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç?"
4. "–°–µ–∫—Ä–µ—Ç—ã –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç –ò–ò"
5. "–ë—É–¥—É—â–µ–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π: –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ 2025"

üìÖ <b>–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é:</b>
‚Ä¢ –ü–ù: –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Å—Ç + –ø–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç
‚Ä¢ –í–¢: –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç + –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞
‚Ä¢ –°–†: –ù–æ–≤–æ—Å—Ç–∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ + –≤–∞—à–µ –º–Ω–µ–Ω–∏–µ
‚Ä¢ –ß–¢: –ö–µ–π—Å/–∏—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞ + –≤—ã–≤–æ–¥—ã
‚Ä¢ –ü–¢: –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç + –≤–æ–ø—Ä–æ—Å –∞—É–¥–∏—Ç–æ—Ä–∏–∏
‚Ä¢ –°–ë: –ü–æ–¥–±–æ—Ä–∫–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
‚Ä¢ –í–°: –ò—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏ + –ø–ª–∞–Ω—ã

üéØ <b>–§–æ—Ä–º–∞—Ç—ã —Å –≤—ã—Å–æ–∫–∏–º engagement:</b>
‚Ä¢ ‚ùì –í–æ–ø—Ä–æ—Å—ã –∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (+156% –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)
‚Ä¢ üìã –ß–µ–∫-–ª–∏—Å—Ç—ã –∏ —Å–ø–∏—Å–∫–∏ (+89% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π)
‚Ä¢ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ñ–∞–∫—Ç—ã (+67% —Ä–µ–ø–æ—Å—Ç–æ–≤)
‚Ä¢ üí° –õ–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Å–æ–≤–µ—Ç—ã (+92% –ª–∞–π–∫–æ–≤)
‚Ä¢ üî• –ì–æ—Ä—è—á–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ (+134% –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤)

üöÄ –•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ –∏–¥–µ–π? –£—Ç–æ—á–Ω–∏—Ç–µ —Ç–µ–º–∞—Ç–∏–∫—É!
    """,
    parse_mode = "HTML",
    reply_markup = ai_chat_keyboard()

)

await callback.message.edit_text(ideas_text)

# ========================================
# –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô
# ========================================

@ router.callback_query(F.data == "ai_knowledge")
async

def show_ai_knowledge(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ò–ò"""
    await callback.message.edit_text(
        """
üìö <b>–ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –ò–ò</b>

–í—Å—ë, —á—Ç–æ –∑–Ω–∞–µ—Ç –ò–ò –æ –≤–∞—à–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ!

üìä <b>–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</b>
‚Ä¢ üìù –ü–æ—Å—Ç–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 342
‚Ä¢ üë• –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π: 12,450
‚Ä¢ üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑—É—á–µ–Ω–æ: 1,823
‚Ä¢ üîÑ –ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤—ã—è–≤–ª–µ–Ω–æ: 47

üß† <b>–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã:</b>

1Ô∏è‚É£ <b>–í–∞—à–∞ –∞—É–¥–∏—Ç–æ—Ä–∏—è –ª—é–±–∏—Ç:</b>
   ‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã (89% engagement)
   ‚Ä¢ –õ–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ (76% engagement)
   ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ (82% engagement)

2Ô∏è‚É£ <b>–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</b>
   ‚Ä¢ –î–ª–∏–Ω–∞: 180-220 —Å–∏–º–≤–æ–ª–æ–≤
   ‚Ä¢ –≠–º–æ–¥–∑–∏: 3-4 —à—Ç—É–∫–∏
   ‚Ä¢ –•–µ—à—Ç–µ–≥–∏: 2-3 —à—Ç—É–∫–∏
   ‚Ä¢ –í—Ä–µ–º—è: 09:00, 15:00, 20:00

3Ô∏è‚É£ <b>–¢—Ä–∏–≥–≥–µ—Ä—ã –≤–æ–≤–ª–µ—á–µ–Ω–∏—è:</b>
   ‚Ä¢ –í–æ–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞
   ‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏
   ‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —á–µ–∫-–ª–∏—Å—Ç—ã
   ‚Ä¢ –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã

üìà <b>–¢—Ä–µ–Ω–¥—ã –≤ –≤–∞—à–µ–π –Ω–∏—à–µ:</b>
‚Ä¢ –ò–ò –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (+234%)
‚Ä¢ –õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ (+156%)
‚Ä¢ –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (+98%)
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (+87%)

üíæ <b>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:</b>
–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å –∏–Ω—Å–∞–π—Ç–∞–º–∏
        """,
        parse_mode="HTML",
        reply_markup=ai_control_panel_keyboard()
    )


# ========================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ========================================

@router.callback_query(F.data == "back_to_main")
async def back_to_main(callback: CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    from utils.keyboards import main_menu_keyboard

    await callback.message.answer(
        "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
        reply_markup=main_menu_keyboard()
    )
    await callback.message.delete()


@router.message(F.text == "ü§ñ –ò–ò-–ü–∞–Ω–µ–ª—å")
async def show_ai_panel_button(message: Message):
    """–ü–æ–∫–∞–∑ –ò–ò –ø–∞–Ω–µ–ª–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é"""
    await show_ai_panel(message)
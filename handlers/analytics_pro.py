# handlers/analytics_pro.py - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
import logging
from datetime import datetime, timedelta
from typing import Dict, List
import statistics

from utils.keyboards import analytics_pro_keyboard
from config import config

logger = logging.getLogger(__name__)
router = Router()


def is_admin(user_id: int) -> bool:
    return user_id == config.ADMIN_ID


# ========================================
# –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ê–ù–ê–õ–ò–¢–ò–ö–ò
# ========================================

@router.message(Command("analytics"))
async def show_analytics(message: Message):
    """–ü–æ–∫–∞–∑ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
    if not is_admin(message.from_user.id):
        return

    await message.answer(
        """
üìä <b>–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê</b>

–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∞—à–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º!

üìà <b>–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:</b>
‚Ä¢ –û–±—â–∏–π –æ—Ö–≤–∞—Ç: 45.2K –∑–∞ –Ω–µ–¥–µ–ª—é
‚Ä¢ Engagement rate: 5.8% (+12%)
‚Ä¢ –†–æ—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏: +324 –∑–∞ –Ω–µ–¥–µ–ª—é
‚Ä¢ –ö–æ–Ω–≤–µ—Ä—Å–∏—è: 2.4%

üéØ <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:</b>
‚Ä¢ Dashboard - –æ–±—â–∏–π –æ–±–∑–æ—Ä
‚Ä¢ Engagement - –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å
‚Ä¢ –¢—Ä–µ–Ω–¥—ã - –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
‚Ä¢ –í–∏—Ä—É—Å–Ω–æ—Å—Ç—å - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ê—É–¥–∏—Ç–æ—Ä–∏—è - –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã
‚Ä¢ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è - –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã

üöÄ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</b>
        """,
        parse_mode="HTML",
        reply_markup=analytics_pro_keyboard()
    )


@router.message(F.text == "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ Pro")
async def show_analytics_button(message: Message):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é"""
    await show_analytics(message)


# ========================================
# DASHBOARD
# ========================================

@router.callback_query(F.data == "analytics_dashboard")
async def show_dashboard(callback: CallbackQuery, performance_tracker, db):
    """–ü–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
        if performance_tracker:
            weekly_report = await performance_tracker.generate_daily_report()
            channel_analytics = {}

            # –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –∫–∞–Ω–∞–ª–∞–º
            channels = await db.get_channels()
            for channel in channels[:3]:  # –¢–æ–ø 3 –∫–∞–Ω–∞–ª–∞
                analytics = await performance_tracker.get_channel_analytics(
                    channel['channel_id'],
                    period_days=7
                )
                channel_analytics[channel['channel_name']] = analytics
        else:
            # –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            weekly_report = {
                'posts_count': 35,
                'total_metrics': {
                    'views': 45200,
                    'likes': 2340,
                    'shares': 567,
                    'comments': 234
                }
            }
            channel_analytics = {}

        # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—à–±–æ—Ä–¥
        response = f"""
üìä <b>DASHBOARD - –û–ë–ó–û–† –ó–ê 7 –î–ù–ï–ô</b>

üìà <b>–û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>
‚Ä¢ üìù –ü–æ—Å—Ç–æ–≤: {weekly_report.get('posts_count', 0)}
‚Ä¢ üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {weekly_report.get('total_metrics', {}).get('views', 0):,}
‚Ä¢ ‚ù§Ô∏è –†–µ–∞–∫—Ü–∏–∏: {weekly_report.get('total_metrics', {}).get('likes', 0):,}
‚Ä¢ üîÑ –†–µ–ø–æ—Å—Ç—ã: {weekly_report.get('total_metrics', {}).get('shares', 0):,}
‚Ä¢ üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {weekly_report.get('total_metrics', {}).get('comments', 0):,}

üìä <b>–°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/–ø–æ—Å—Ç: {weekly_report.get('total_metrics', {}).get('views', 0) // max(weekly_report.get('posts_count', 1), 1):,}
‚Ä¢ Engagement rate: 5.8%
‚Ä¢ –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å: 12.4%

üèÜ <b>–¢–æ–ø –∫–∞–Ω–∞–ª—ã:</b>
"""

        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ø –∫–∞–Ω–∞–ª—ã
        for i, (channel_name, analytics) in enumerate(list(channel_analytics.items())[:3], 1):
            response += f"{i}. {channel_name}: {analytics.get('total_views', 0):,} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤\n"

        response += """

üìà <b>–î–∏–Ω–∞–º–∏–∫–∞ –Ω–µ–¥–µ–ª–∏:</b>
–ü–ù: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 6.2K
–í–¢: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 7.8K  
–°–†: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 7.1K
–ß–¢: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 5.4K
–ü–¢: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 6.3K
–°–ë: ‚ñà‚ñà‚ñà‚ñà‚ñà 4.1K
–í–°: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 4.8K

üí° <b>–ò–Ω—Å–∞–π—Ç—ã:</b>
‚Ä¢ –õ—É—á—à–∏–π –¥–µ–Ω—å: –í—Ç–æ—Ä–Ω–∏–∫ (+25% –∫ —Å—Ä–µ–¥–Ω–µ–º—É)
‚Ä¢ –•—É–¥—à–∏–π –¥–µ–Ω—å: –°—É–±–±–æ—Ç–∞ (-32% –∫ —Å—Ä–µ–¥–Ω–µ–º—É)
‚Ä¢ –ü–∏–∫–æ–≤–æ–µ –≤—Ä–µ–º—è: 20:00-21:00
‚Ä¢ –†–æ—Å—Ç –∑–∞ –Ω–µ–¥–µ–ª—é: +12.4%

üéØ <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>
‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫
‚Ä¢ –°–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Å—Ç—ã –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ
‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞: {e}")
        await callback.message.edit_text(
            "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞",
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )


# ========================================
# ENGAGEMENT –ê–ù–ê–õ–ò–¢–ò–ö–ê
# ========================================

@router.callback_query(F.data == "analytics_engagement")
async def show_engagement_analytics(callback: CallbackQuery, performance_tracker):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏"""
    try:
        response = """
üéØ <b>–ê–ù–ê–õ–ò–¢–ò–ö–ê ENGAGEMENT</b>

üìä <b>–û–±—â–∏–π Engagement Rate: 5.8%</b>
(+1.2% –∫ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ)

üìà <b>–†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:</b>
‚Ä¢ ‚ù§Ô∏è –õ–∞–π–∫–∏: 52% –æ—Ç –≤—Å–µ—Ö —Ä–µ–∞–∫—Ü–∏–π
‚Ä¢ üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: 28% (+5%)
‚Ä¢ üîÑ –†–µ–ø–æ—Å—Ç—ã: 15% (-2%)
‚Ä¢ üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: 5% (+1%)

üéØ <b>Engagement –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</b>
1. ‚ùì –í–æ–ø—Ä–æ—Å—ã: 8.9% ER
2. üìã –°–ø–∏—Å–∫–∏: 7.2% ER
3. üì∞ –ù–æ–≤–æ—Å—Ç–∏: 5.4% ER
4. üí° –°–æ–≤–µ—Ç—ã: 4.8% ER
5. üì∏ –§–æ—Ç–æ: 4.2% ER

‚è∞ <b>Engagement –ø–æ –≤—Ä–µ–º–µ–Ω–∏:</b>
‚Ä¢ üåÖ –£—Ç—Ä–æ (7-12): 4.2%
‚Ä¢ ‚òÄÔ∏è –î–µ–Ω—å (12-18): 5.1%
‚Ä¢ üåô –í–µ—á–µ—Ä (18-23): 7.4%
‚Ä¢ üåÉ –ù–æ—á—å (23-7): 2.1%

üì± <b>–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º:</b>
‚Ä¢ –ë—É–¥–Ω–∏: 6.2% avg
‚Ä¢ –í—ã—Ö–æ–¥–Ω—ã–µ: 4.1% avg
‚Ä¢ –õ—É—á—à–∏–π –¥–µ–Ω—å: –°—Ä–µ–¥–∞ (7.8%)
‚Ä¢ –•—É–¥—à–∏–π –¥–µ–Ω—å: –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (3.2%)

üí¨ <b>–ê–Ω–∞–ª–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:</b>
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –ø–æ—Å—Ç: 6.7
‚Ä¢ –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: 78% –ø–æ–∑–∏—Ç–∏–≤
‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: 45%
‚Ä¢ –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: ~2 —á–∞—Å–∞

üî• <b>–°–∞–º—ã–µ –≤–æ–≤–ª–µ–∫–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</b>
1. –í–æ–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞: +156% –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
2. –ü—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é: +89% –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
3. –≠–º–æ–¥–∑–∏ –≤ —Ç–µ–∫—Å—Ç–µ: +45% –ª–∞–π–∫–æ–≤
4. –õ–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏: +67% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

üí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—é:</b>
‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∫ –∫–∞–∂–¥–æ–º—É –ø–æ—Å—Ç—É
‚Ä¢ –ü—É–±–ª–∏–∫—É–π—Ç–µ –≤ 19:00-21:00
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª—å—à–µ —Å–ø–∏—Å–∫–æ–≤
‚Ä¢ –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—ã—Å—Ç—Ä–µ–µ
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ engagement –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")


# ========================================
# –ê–ù–ê–õ–ò–ó –¢–†–ï–ù–î–û–í
# ========================================

@router.callback_query(F.data == "analytics_trends")
async def show_trends_analytics(callback: CallbackQuery, smart_analyzer):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤"""
    try:
        response = """
üìà <b>–ê–ù–ê–õ–ò–ó –¢–†–ï–ù–î–û–í</b>

üî• <b>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã –≤ –≤–∞—à–µ–π –Ω–∏—à–µ:</b>

1. ü§ñ <b>–ò–ò –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</b>
   ‚Ä¢ –†–æ—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å–∞: +234% –∑–∞ –º–µ—Å—è—Ü
   ‚Ä¢ –û—Ö–≤–∞—Ç: 125K –Ω–∞ –ø–æ—Å—Ç
   ‚Ä¢ ER: 8.9%

2. üíº <b>–£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞</b>
   ‚Ä¢ –†–æ—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å–∞: +156% –∑–∞ –º–µ—Å—è—Ü
   ‚Ä¢ –û—Ö–≤–∞—Ç: 89K –Ω–∞ –ø–æ—Å—Ç
   ‚Ä¢ ER: 7.2%

3. üì± <b>–¶–∏—Ñ—Ä–æ–≤–æ–π –¥–µ—Ç–æ–∫—Å</b>
   ‚Ä¢ –†–æ—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å–∞: +98% –∑–∞ –º–µ—Å—è—Ü
   ‚Ä¢ –û—Ö–≤–∞—Ç: 67K –Ω–∞ –ø–æ—Å—Ç
   ‚Ä¢ ER: 6.4%

üìä <b>–¢—Ä–µ–Ω–¥—ã –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º:</b>
‚Ä¢ üìπ –í–∏–¥–µ–æ < 60 —Å–µ–∫: +312% –æ—Ö–≤–∞—Ç
‚Ä¢ üé† –ö–∞—Ä—É—Å–µ–ª–∏: +189% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
‚Ä¢ üìã –ß–µ–∫-–ª–∏—Å—Ç—ã: +156% —Ä–µ–ø–æ—Å—Ç–æ–≤
‚Ä¢ ‚ùì –û–ø—Ä–æ—Å—ã: +234% –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

üéØ <b>–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è –≤ —Ç—Ä–µ–Ω–¥–∞—Ö:</b>
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ: 3/10 —Ç—Ä–µ–Ω–¥–æ–≤
‚Ä¢ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–æ—Å—Ç–∞: +156%
‚Ä¢ –£–ø—É—â–µ–Ω–Ω—ã–π –æ—Ö–≤–∞—Ç: ~234K/–º–µ—Å—è—Ü

üìÖ <b>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü:</b>
1. üîÆ Web3 –∏ –º–µ—Ç–∞–≤—Å–µ–ª–µ–Ω–Ω—ã–µ
2. üß† –ù–µ–π—Ä–æ–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
3. üå± –£—Å—Ç–æ–π—á–∏–≤–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ
4. üéÆ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è

üöÄ <b>–ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ —Ç—Ä–µ–Ω–¥—ã:</b>
‚Ä¢ –ü–µ—Ä–≤—ã–º–∏ –æ—Å–≤–µ—â–∞–π—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Ö–µ—à—Ç–µ–≥–∏
‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç –æ –±—É–¥—É—â–µ–º
‚Ä¢ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

üí° <b>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</b>
‚Ä¢ –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç –ø—Ä–æ –ò–ò —Å–µ–≥–æ–¥–Ω—è
‚Ä¢ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–∏—é –ø—Ä–æ —É–¥–∞–ª–µ–Ω–∫—É
‚Ä¢ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ-—Ñ–æ—Ä–º–∞—Ç
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤")


# ========================================
# –ê–ù–ê–õ–ò–ó –í–ò–†–£–°–ù–û–°–¢–ò
# ========================================

@router.callback_query(F.data == "analytics_viral")
async def show_viral_analytics(callback: CallbackQuery, performance_tracker):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞"""
    try:
        response = """
üî• <b>–ê–ù–ê–õ–ò–ó –í–ò–†–£–°–ù–û–°–¢–ò</b>

üöÄ <b>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç–∏: 0.124</b>
(12.4% –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –¥–µ–ª–∏—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º)

üìä <b>–í–∏—Ä—É—Å–Ω—ã–µ –ø–æ—Å—Ç—ã –∑–∞ –º–µ—Å—è—Ü:</b>

1. ü•á <b>"5 –æ—à–∏–±–æ–∫ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö..."</b>
   ‚Ä¢ –û—Ö–≤–∞—Ç: 125K (–æ–±—ã—á–Ω—ã–π: 12K)
   ‚Ä¢ –†–µ–ø–æ—Å—Ç—ã: 892
   ‚Ä¢ –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å: x10.4

2. ü•à <b>"–®–æ–∫–∏—Ä—É—é—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ..."</b>
   ‚Ä¢ –û—Ö–≤–∞—Ç: 89K (–æ–±—ã—á–Ω—ã–π: 12K)
   ‚Ä¢ –†–µ–ø–æ—Å—Ç—ã: 567
   ‚Ä¢ –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å: x7.4

3. ü•â <b>"–ü—Ä–æ—Å—Ç–æ–π –ª–∞–π—Ñ—Ö–∞–∫, –∫–æ—Ç–æ—Ä—ã–π..."</b>
   ‚Ä¢ –û—Ö–≤–∞—Ç: 67K (–æ–±—ã—á–Ω—ã–π: 12K)
   ‚Ä¢ –†–µ–ø–æ—Å—Ç—ã: 423
   ‚Ä¢ –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å: x5.6

üîç <b>–§–∞–∫—Ç–æ—Ä—ã –≤–∏—Ä—É—Å–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ üò± –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä: +312%
‚Ä¢ üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞: +234%
‚Ä¢ ü§î –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–∞–∫—Ç: +189%
‚Ä¢ üí¨ –ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è –¥–∏—Å–∫—É—Å—Å–∏–∏: +156%
‚Ä¢ üì∏ –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: +123%

üìà <b>–ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</b>
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —Ü–∏—Ñ—Ä–æ–π (5, 7, 10)
2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ (—à–æ–∫, —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ)
3. –û–±–µ—â–∞–Ω–∏–µ –ø–æ–ª—å–∑—ã (–Ω–∞—É—á–∏—Ç–µ—Å—å, —É–∑–Ω–∞–π—Ç–µ)
4. –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
5. –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è

‚è∞ <b>–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤–∏—Ä—É—Å–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ –ë—É–¥–Ω–∏: 19:00-21:00
‚Ä¢ –í—ã—Ö–æ–¥–Ω—ã–µ: 11:00-13:00

üéØ <b>–í–∞—à –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª:</b>
‚Ä¢ –¢–µ–∫—É—â–∞—è –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å: 12.4%
‚Ä¢ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: –¥–æ 25-30%
‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ: +5-7 —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

üí° <b>–§–æ—Ä–º—É–ª–∞ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞:</b>
[–ß–∏—Å–ª–æ] + [–≠–º–æ—Ü–∏—è] + [–ü–æ–ª—å–∑–∞] + [–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç—å]

–ü—Ä–∏–º–µ—Ä: "7 —à–æ–∫–∏—Ä—É—é—â–∏—Ö —Ñ–∞–∫—Ç–æ–≤ –æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—Ç –≤–∞—à—É –∂–∏–∑–Ω—å"

üöÄ <b>–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:</b>
1. –°–æ–∑–¥–∞—Ç—å 3 –ø–æ—Å—Ç–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∏–∫–æ–≤–æ–µ –≤—Ä–µ–º—è
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª –∫ –∫–∞–∂–¥–æ–º—É
4. –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–≤—ã–µ 2 —á–∞—Å–∞
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤–∏—Ä—É—Å–Ω–æ—Å—Ç–∏: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")


# ========================================
# –ê–ù–ê–õ–ò–ó –ê–£–î–ò–¢–û–†–ò–ò
# ========================================

@router.callback_query(F.data == "analytics_audience")
async def show_audience_analytics(callback: CallbackQuery, db):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∫–∞–Ω–∞–ª–∞—Ö
        channels = await db.get_channels()
        total_audience = sum(12450 for _ in channels)  # –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

        response = f"""
üë• <b>–ê–ù–ê–õ–ò–ó –ê–£–î–ò–¢–û–†–ò–ò</b>

üìä <b>–û–±—â–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {total_audience:,}</b>
‚Ä¢ –ê–∫—Ç–∏–≤–Ω–∞—è: {int(total_audience * 0.35):,} (35%)
‚Ä¢ –†–æ—Å—Ç –∑–∞ –º–µ—Å—è—Ü: +12.4%

üë§ <b>–î–µ–º–æ–≥—Ä–∞—Ñ–∏—è:</b>
‚Ä¢ üë® –ú—É–∂—á–∏–Ω—ã: 58%
‚Ä¢ üë© –ñ–µ–Ω—â–∏–Ω—ã: 42%

üìç <b>–ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–¢–æ–ø-5):</b>
1. üá∑üá∫ –†–æ—Å—Å–∏—è: 45%
2. üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞: 18%
3. üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω: 12%
4. üáßüáæ –ë–µ–ª–∞—Ä—É—Å—å: 8%
5. üá∫üá∏ –°–®–ê: 5%

üì± <b>–í–æ–∑—Ä–∞—Å—Ç:</b>
‚Ä¢ 18-24: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 22%
‚Ä¢ 25-34: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 38%
‚Ä¢ 35-44: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 24%
‚Ä¢ 45-54: ‚ñà‚ñà‚ñà‚ñà 11%
‚Ä¢ 55+: ‚ñà‚ñà 5%

üíº <b>–ò–Ω—Ç–µ—Ä–µ—Å—ã –∞—É–¥–∏—Ç–æ—Ä–∏–∏:</b>
1. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ IT: 67%
2. –ë–∏–∑–Ω–µ—Å –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã: 54%
3. –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ: 48%
4. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥: 41%
5. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: 38%

üïê <b>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏:</b>
‚Ä¢ –£—Ç—Ä–æ (6-9): 15%
‚Ä¢ –î–µ–Ω—å (9-18): 35%
‚Ä¢ –í–µ—á–µ—Ä (18-22): 40%
‚Ä¢ –ù–æ—á—å (22-6): 10%

üì± <b>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</b>
‚Ä¢ üì± Mobile: 78%
‚Ä¢ üíª Desktop: 18%
‚Ä¢ üì± Tablet: 4%

üéØ <b>–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:</b>
‚Ä¢ –ß–∏—Ç–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é: 45%
‚Ä¢ –õ–∞–π–∫–∞—é—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ: 23%
‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É—é—Ç: 8%
‚Ä¢ –î–µ–ª—è—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º: 12%
‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è—é—Ç: 15%

üí° <b>–ò–Ω—Å–∞–π—Ç—ã:</b>
‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è –¶–ê: –º—É–∂—á–∏–Ω—ã 25-34 –∏–∑ IT
‚Ä¢ –ü–∏–∫–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –±—É–¥–Ω–∏ 20:00
‚Ä¢ –õ—é–±—è—Ç: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
‚Ä¢ –ò–≥–Ω–æ—Ä–∏—Ä—É—é—Ç: –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã

üöÄ <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>
‚Ä¢ –§–æ–∫—É—Å –Ω–∞ IT –∏ –±–∏–∑–Ω–µ—Å —Ç–µ–º—ã
‚Ä¢ –ë–æ–ª—å—à–µ –∫–µ–π—Å–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤
‚Ä¢ –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ 19:00-21:00
‚Ä¢ –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")


# ========================================
# –ú–û–ù–ï–¢–ò–ó–ê–¶–ò–Ø
# ========================================

@router.callback_query(F.data == "analytics_money")
async def show_monetization_analytics(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏"""
    try:
        response = """
üí∞ <b>–ê–ù–ê–õ–ò–¢–ò–ö–ê –ú–û–ù–ï–¢–ò–ó–ê–¶–ò–ò</b>

üíµ <b>–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü: $3,450</b>
‚Ä¢ –†–æ—Å—Ç –∫ –ø—Ä–æ—à–ª–æ–º—É –º–µ—Å—è—Ü—É: +34%

üìä <b>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞:</b>
1. üì¢ –†–µ–∫–ª–∞–º–∞: $1,890 (55%)
2. üõç –ü—Ä–æ–¥–∞–∂–∏: $890 (26%)
3. üéÅ –î–æ–Ω–∞—Ç—ã: $450 (13%)
4. ü§ù –ü–∞—Ä—Ç–Ω–µ—Ä–∫–∏: $220 (6%)

üìà <b>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</b>
‚Ä¢ CPM: $4.50
‚Ä¢ CPC: $0.12
‚Ä¢ CTR: 2.4%
‚Ä¢ –ö–æ–Ω–≤–µ—Ä—Å–∏—è: 1.8%
‚Ä¢ AOV: $45

üí∏ <b>–†–∞—Å—Ö–æ–¥—ã:</b>
‚Ä¢ ü§ñ OpenAI API: $28
‚Ä¢ üì± Telegram Premium: $5
‚Ä¢ üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: $15
‚Ä¢ üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: $10
<b>–ò—Ç–æ–≥–æ:</b> $58

üìä <b>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: $3,392</b>
‚Ä¢ ROI: 5,848%
‚Ä¢ –ú–∞—Ä–∂–∞: 98.3%

üéØ <b>–õ—É—á—à–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏:</b>
1. –ù–∞—Ç–∏–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞: $125/–ø–æ—Å—Ç
2. –û–±–∑–æ—Ä—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤: $89/–ø–æ—Å—Ç  
3. –ü—Ä–æ–º–æ–∫–æ–¥—ã: $67/–ø–æ—Å—Ç
4. –°–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ: $450/–Ω–µ–¥–µ–ª—è

üì± <b>–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∫–∞–Ω–∞–ª–∞–º:</b>
‚Ä¢ –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª: 2.4%
‚Ä¢ –í—Ç–æ—Ä–æ–π –∫–∞–Ω–∞–ª: 1.8%
‚Ä¢ –¢—Ä–µ—Ç–∏–π –∫–∞–Ω–∞–ª: 1.2%

üí° <b>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–æ—Å—Ç–∞:</b>
‚Ä¢ –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π: $2,100/–º–µ—Å
‚Ä¢ –ü—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: +156%
‚Ä¢ –ù–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: +$890/–º–µ—Å

üöÄ <b>–ü–ª–∞–Ω —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞:</b>
1. –ü–æ–¥–Ω—è—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ä–µ–∫–ª–∞–º—ã –¥–æ 15%
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
3. –î–æ–±–∞–≤–∏—Ç—å –∞—Ñ—Ñ–∏–ª–∏–∞—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã
4. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ–ø—Ä–æ–¥—É–∫—Ç

‚ö° <b>–ë—ã—Å—Ç—Ä—ã–µ wins:</b>
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å CTR (+$340/–º–µ—Å)
‚Ä¢ –ü–æ–¥–Ω—è—Ç—å —Ü–µ–Ω—ã –Ω–∞ 20% (+$690/–º–µ—Å)
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ (+$450/–º–µ—Å)
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")


# ========================================
# –ê–ù–ê–õ–ò–¢–ò–ö–ê –ü–û –ü–ï–†–ò–û–î–ê–ú
# ========================================

@router.callback_query(F.data == "analytics_periods")
async def show_periods_analytics(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º"""
    response = """
üìÖ <b>–ê–ù–ê–õ–ò–¢–ò–ö–ê –ü–û –ü–ï–†–ò–û–î–ê–ú</b>

–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

üìä <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:</b>
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞
‚Ä¢ –í–µ—Å—å –ø–µ—Ä–∏–æ–¥

üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    """

    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üìç 24 —á–∞—Å–∞", callback_data="period_1d"),
                InlineKeyboardButton(text="üìÖ 7 –¥–Ω–µ–π", callback_data="period_7d")
            ],
            [
                InlineKeyboardButton(text="üìÜ 30 –¥–Ω–µ–π", callback_data="period_30d"),
                InlineKeyboardButton(text="üóì 3 –º–µ—Å—è—Ü–∞", callback_data="period_90d")
            ],
            [
                InlineKeyboardButton(text="üìä –í–µ—Å—å –ø–µ—Ä–∏–æ–¥", callback_data="period_all")
            ],
            [
                InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_analytics")
            ]
        ]
    )

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=keyboard
    )


@router.callback_query(F.data.startswith("period_"))
async def show_period_report(callback: CallbackQuery, performance_tracker):
    """–ü–æ–∫–∞–∑ –æ—Ç—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥"""
    period = callback.data.split("_")[1]

    period_names = {
        "1d": "24 —á–∞—Å–∞",
        "7d": "7 –¥–Ω–µ–π",
        "30d": "30 –¥–Ω–µ–π",
        "90d": "3 –º–µ—Å—è—Ü–∞",
        "all": "–≤–µ—Å—å –ø–µ—Ä–∏–æ–¥"
    }

    period_days = {
        "1d": 1,
        "7d": 7,
        "30d": 30,
        "90d": 90,
        "all": 365
    }

    period_name = period_names.get(period, period)
    days = period_days.get(period, 7)

    # –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥
    # –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

    response = f"""
üìÖ <b>–û–¢–ß–ï–¢ –ó–ê {period_name.upper()}</b>

üìä <b>–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>
‚Ä¢ üìù –ü–æ—Å—Ç–æ–≤: {days * 5}
‚Ä¢ üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {days * 6500:,}
‚Ä¢ ‚ù§Ô∏è Engagement: {5.8 + (days * 0.1):.1f}%
‚Ä¢ üìà –†–æ—Å—Ç: +{days * 1.8:.1f}%

üìà <b>–î–∏–Ω–∞–º–∏–∫–∞:</b>
{'‚ñà' * min(days, 20)} +{days * 1.8:.1f}%

üèÜ <b>–¢–æ–ø –ø–æ—Å—Ç—ã –ø–µ—Ä–∏–æ–¥–∞:</b>
1. "–ö–∞–∫ —è —É–≤–µ–ª–∏—á–∏–ª –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 300%" - 12.5K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
2. "5 –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ" - 9.8K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
3. "–°–µ–∫—Ä–µ—Ç –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞" - 8.2K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

üí° <b>–ì–ª–∞–≤–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã:</b>
‚Ä¢ –õ—É—á—à–∏–π –¥–µ–Ω—å: –í—Ç–æ—Ä–Ω–∏–∫
‚Ä¢ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: 20:00
‚Ä¢ –õ—É—á—à–∏–π —Ñ–æ—Ä–º–∞—Ç: –°–ø–∏—Å–∫–∏
‚Ä¢ –•—É–¥—à–∏–π –¥–µ–Ω—å: –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ

üìä <b>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º:</b>
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: +23.4%
‚Ä¢ Engagement: +1.2%
‚Ä¢ –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: +{days * 12}
‚Ä¢ –û—Ç–ø–∏—Å–∫–∏: -{days * 2}

üéØ <b>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ KPI:</b>
‚Ä¢ –û—Ö–≤–∞—Ç: ‚úÖ 124% –æ—Ç –ø–ª–∞–Ω–∞
‚Ä¢ Engagement: ‚úÖ 108% –æ—Ç –ø–ª–∞–Ω–∞
‚Ä¢ –†–æ—Å—Ç –±–∞–∑—ã: ‚ö†Ô∏è 89% –æ—Ç –ø–ª–∞–Ω–∞
‚Ä¢ –ö–æ–Ω–≤–µ—Ä—Å–∏–∏: ‚úÖ 115% –æ—Ç –ø–ª–∞–Ω–∞
    """

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç", callback_data=f"download_report_{period}"),
                InlineKeyboardButton(text="üìä –î—Ä—É–≥–æ–π –ø–µ—Ä–∏–æ–¥", callback_data="analytics_periods")
            ],
            [
                InlineKeyboardButton(text="üîô –ö –∞–Ω–∞–ª–∏—Ç–∏–∫–µ", callback_data="back_to_analytics")
            ]
        ]
    )

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=keyboard
    )


# ========================================
# –¢–û–ü –ö–û–ù–¢–ï–ù–¢
# ========================================

@router.callback_query(F.data == "analytics_top")
async def show_top_content(callback: CallbackQuery, performance_tracker):
    """–ü–æ–∫–∞–∑ —Ç–æ–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
    try:
        response = """
üèÜ <b>–¢–û–ü –ö–û–ù–¢–ï–ù–¢</b>

ü•á <b>–¢–æ–ø-10 –ø–æ—Å—Ç–æ–≤ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è:</b>

1. üî• <b>"5 —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ò–ò"</b>
   ‚Ä¢ üëÅ 125.4K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
   ‚Ä¢ ‚ù§Ô∏è 8.9K –ª–∞–π–∫–æ–≤ (7.1% ER)
   ‚Ä¢ üîÑ 892 —Ä–µ–ø–æ—Å—Ç–∞
   ‚Ä¢ üí¨ 234 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

2. üî• <b>"–®–æ–∫–∏—Ä—É—é—â–∞—è –ø—Ä–∞–≤–¥–∞ –æ ChatGPT"</b>
   ‚Ä¢ üëÅ 98.7K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
   ‚Ä¢ ‚ù§Ô∏è 6.2K –ª–∞–π–∫–æ–≤ (6.3% ER)
   ‚Ä¢ üîÑ 678 —Ä–µ–ø–æ—Å—Ç–æ–≤
   ‚Ä¢ üí¨ 189 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

3. üî• <b>"–ö–∞–∫ —è —É–≤–æ–ª–∏–ª—Å—è –∏ —Å—Ç–∞–ª –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å x10"</b>
   ‚Ä¢ üëÅ 87.3K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
   ‚Ä¢ ‚ù§Ô∏è 5.4K –ª–∞–π–∫–æ–≤ (6.2% ER)
   ‚Ä¢ üîÑ 543 —Ä–µ–ø–æ—Å—Ç–∞
   ‚Ä¢ üí¨ 167 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

üìä <b>–¢–æ–ø –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</b>

<b>üéØ –õ—É—á—à–∏–π Engagement:</b>
"–£–≥–∞–¥–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ —è –∑–∞—Ä–∞–±–æ—Ç–∞–ª?" - 12.4% ER

<b>üí¨ –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:</b>
"–ê –≤—ã —Å–æ–≥–ª–∞—Å–Ω—ã —Å —ç—Ç–∏–º?" - 456 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

<b>üîÑ –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–µ–ø–æ—Å—Ç–æ–≤:</b>
"–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å" - 1,234 —Ä–µ–ø–æ—Å—Ç–∞

<b>‚ö° –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç:</b>
"–°—Ä–æ—á–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏!" - 50K –∑–∞ 2 —á–∞—Å–∞

üîç <b>–û–±—â–∏–µ —á–µ—Ä—Ç—ã —Ç–æ–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</b>
‚Ä¢ –¶–∏—Ñ—Ä—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ (78% —Ç–æ–ø –ø–æ—Å—Ç–æ–≤)
‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ (92%)
‚Ä¢ –õ–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ (65%)
‚Ä¢ –í–æ–ø—Ä–æ—Å—ã –∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (71%)
‚Ä¢ 3-5 —ç–º–æ–¥–∑–∏ (85%)
‚Ä¢ 200-250 —Å–∏–º–≤–æ–ª–æ–≤ (68%)

üí° <b>–§–æ—Ä–º—É–ª–∞ —É—Å–ø–µ—Ö–∞:</b>
[–¶–∏—Ñ—Ä–∞] + [–≠–º–æ—Ü–∏—è] + [–ü–æ–ª—å–∑–∞] + [–ò—Å—Ç–æ—Ä–∏—è] + [–í–æ–ø—Ä–æ—Å]

üöÄ <b>–ö–∞–∫ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Å–ø–µ—Ö:</b>
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –ª–∏—á–Ω—ã–π –æ–ø—ã—Ç
3. –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã
4. –ü—É–±–ª–∏–∫—É–π—Ç–µ –≤ 20:00
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 3-4 —ç–º–æ–¥–∑–∏
        """

        await callback.message.edit_text(
            response,
            parse_mode="HTML",
            reply_markup=analytics_pro_keyboard()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ç–æ–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {e}")
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")


# ========================================
# –≠–ö–°–ü–û–†–¢ –û–¢–ß–ï–¢–û–í
# ========================================

@router.callback_query(F.data == "analytics_export")
async def show_export_options(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –æ–ø—Ü–∏–π —ç–∫—Å–ø–æ—Ä—Ç–∞"""
    response = """
‚¨áÔ∏è <b>–≠–ö–°–ü–û–†–¢ –ê–ù–ê–õ–ò–¢–ò–ö–ò</b>

–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∏ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:

üìÑ <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</b>
‚Ä¢ PDF - –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á–µ—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
‚Ä¢ Excel - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚Ä¢ CSV - –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ JSON - –¥–ª—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

üìä <b>–¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤:</b>
‚Ä¢ –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø–æ—Å—Ç–∞–º
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏—Ç–æ—Ä–∏–∏
‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç
‚Ä¢ –û—Ç—á–µ—Ç –ø–æ —Ç—Ä–µ–Ω–¥–∞–º

üîê –í—Å–µ –æ—Ç—á–µ—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞–º
    """

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üìë PDF –æ—Ç—á–µ—Ç", callback_data="export_pdf"),
                InlineKeyboardButton(text="üìä Excel –¥–∞–Ω–Ω—ã–µ", callback_data="export_excel")
            ],
            [
                InlineKeyboardButton(text="üìã CSV —ç–∫—Å–ø–æ—Ä—Ç", callback_data="export_csv"),
                InlineKeyboardButton(text="üîß JSON –¥–∞–Ω–Ω—ã–µ", callback_data="export_json")
            ],
            [
                InlineKeyboardButton(text="üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email", callback_data="export_email")
            ],
            [
                InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_analytics")
            ]
        ]
    )

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=keyboard
    )


@router.callback_query(F.data.startswith("export_"))
async def process_export(callback: CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞"""
    export_format = callback.data.split("_")[1]

    await callback.answer("üîÑ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é —ç–∫—Å–ø–æ—Ä—Ç...")

    # –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞
    # –ü–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É

    format_names = {
        "pdf": "PDF –æ—Ç—á–µ—Ç",
        "excel": "Excel —Ñ–∞–π–ª",
        "csv": "CSV –¥–∞–Ω–Ω—ã–µ",
        "json": "JSON —Ñ–∞–π–ª",
        "email": "–æ—Ç—á–µ—Ç –Ω–∞ email"
    }

    format_name = format_names.get(export_format, export_format)

    response = f"""
‚úÖ <b>–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤!</b>

üìÑ <b>–§–æ—Ä–º–∞—Ç:</b> {format_name}
üìä <b>–ü–µ—Ä–∏–æ–¥:</b> –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
üìÅ <b>–†–∞–∑–º–µ—Ä:</b> 2.4 MB

üîó <b>–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</b>
<code>https://example.com/export/abc123</code>

‚è± –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 24 —á–∞—Å–∞

üí° <b>–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ –æ—Ç—á–µ—Ç:</b>
‚Ä¢ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
‚Ä¢ –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –ø–æ—Å—Ç–∞–º
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏—Ç–æ—Ä–∏–∏
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
    """

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=analytics_pro_keyboard()
    )


# ========================================
# REAL-TIME –ê–ù–ê–õ–ò–¢–ò–ö–ê
# ========================================

@router.callback_query(F.data == "analytics_realtime")
async def show_realtime_analytics(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ real-time –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
    current_time = datetime.now().strftime("%H:%M:%S")

    response = f"""
üîÑ <b>REAL-TIME –ê–ù–ê–õ–ò–¢–ò–ö–ê</b>
–û–±–Ω–æ–≤–ª–µ–Ω–æ: {current_time}

üìä <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 60 –º–∏–Ω—É—Ç:</b>
‚Ä¢ üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: 2,341 (+12%)
‚Ä¢ ‚ù§Ô∏è –õ–∞–π–∫–∏: 127 (+23%)
‚Ä¢ üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: 34 (+45%)
‚Ä¢ üîÑ –†–µ–ø–æ—Å—Ç—ã: 12 (+8%)

üìà <b>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–∏–Ω—É—Ç–∞–º:</b>
<code>
20:00 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 234
20:05 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 189
20:10 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 156
20:15 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 201
20:20 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 245
20:25 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 167
20:30 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 198
</code>

üî• <b>–ì–æ—Ä—è—á–∏–µ –ø–æ—Å—Ç—ã —Å–µ–π—á–∞—Å:</b>
1. "–°—Ä–æ—á–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ..." - 567 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/—á–∞—Å
2. "–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–æ..." - 423 –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—á–∞—Å
3. "–¢–æ–ª—å–∫–æ —á—Ç–æ —É–∑–Ω–∞–ª..." - 345 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/—á–∞—Å

üë• <b>–ê—É–¥–∏—Ç–æ—Ä–∏—è –æ–Ω–ª–∞–π–Ω:</b>
‚Ä¢ –°–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω—ã: ~1,234
‚Ä¢ –ü–∏–∫ –∑–∞ —á–∞—Å: 1,567
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –æ–Ω–ª–∞–π–Ω: 890

üí¨ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</b>
‚Ä¢ "–û—Ç–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è!" - 2 –º–∏–Ω –Ω–∞–∑–∞–¥
‚Ä¢ "–ê –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ?" - 5 –º–∏–Ω –Ω–∞–∑–∞–¥
‚Ä¢ "–°–ø–∞—Å–∏–±–æ, –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ" - 8 –º–∏–Ω –Ω–∞–∑–∞–¥

‚ö° <b>–¢—Ä–µ–Ω–¥—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Å–∞:</b>
‚Ä¢ #–ò–ò - —É–ø–æ–º–∏–Ω–∞–Ω–∏–π: 45 (+234%)
‚Ä¢ #–Ω–æ–≤–æ—Å—Ç–∏ - —É–ø–æ–º–∏–Ω–∞–Ω–∏–π: 34 (+156%)
‚Ä¢ #—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ - —É–ø–æ–º–∏–Ω–∞–Ω–∏–π: 28 (+98%)

üéØ <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–µ–π—á–∞—Å:</b>
‚Ä¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç –ø—Ä–æ –ò–ò
‚Ä¢ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
‚Ä¢ –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - –≤—Ä–µ–º—è –¥–ª—è –≤–∞–∂–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤!
    """

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üîÑ –û–±–Ω–æ–≤–∏—Ç—å", callback_data="analytics_realtime"),
                InlineKeyboardButton(text="‚è∏ –ü–∞—É–∑–∞", callback_data="pause_realtime")
            ],
            [
                InlineKeyboardButton(text="üîô –ö –∞–Ω–∞–ª–∏—Ç–∏–∫–µ", callback_data="back_to_analytics")
            ]
        ]
    )

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=keyboard
    )


# ========================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ========================================

@router.callback_query(F.data == "back_to_analytics")
async def back_to_analytics(callback: CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ"""
    await show_analytics(callback.message)


@router.callback_query(F.data == "analytics_reports")
async def show_reports_menu(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑ –º–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤"""
    response = """
üìã <b>–ì–û–¢–û–í–´–ï –û–¢–ß–ï–¢–´</b>

–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞:

üìä <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:</b>
‚Ä¢ –ù–µ–¥–µ–ª—å–Ω—ã–π –æ–±–∑–æ—Ä
‚Ä¢ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç
‚Ä¢ –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚Ä¢ –ì–æ–¥–æ–≤–æ–π –æ—Ç—á–µ—Ç
‚Ä¢ –û—Ç—á–µ—Ç –ø–æ –∫–∞–Ω–∞–ª—É
‚Ä¢ –û—Ç—á–µ—Ç –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É
‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç

–í—Å–µ –æ—Ç—á–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    """

    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π", callback_data="report_weekly"),
                InlineKeyboardButton(text="üìÜ –ú–µ—Å—è—á–Ω—ã–π", callback_data="report_monthly")
            ],
            [
                InlineKeyboardButton(text="üóì –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π", callback_data="report_quarter"),
                InlineKeyboardButton(text="üìä –ì–æ–¥–æ–≤–æ–π", callback_data="report_yearly")
            ],
            [
                InlineKeyboardButton(text="üì∫ –ü–æ –∫–∞–Ω–∞–ª—É", callback_data="report_channel"),
                InlineKeyboardButton(text="üìù –ü–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É", callback_data="report_content")
            ],
            [
                InlineKeyboardButton(text="üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π", callback_data="report_financial")
            ],
            [
                InlineKeyboardButton(text="üîô –ö –∞–Ω–∞–ª–∏—Ç–∏–∫–µ", callback_data="back_to_analytics")
            ]
        ]
    )

    await callback.message.edit_text(
        response,
        parse_mode="HTML",
        reply_markup=keyboard
    )


# ========================================
# –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –û–°–ù–û–í–ù–´–ú –ú–ï–ù–Æ
# ========================================

@router.message(Command("content_insights"))
async def show_content_insights_command(message: Message, performance_tracker):
    """–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Å–∞–π—Ç–∞–º"""
    if not is_admin(message.from_user.id):
        return

    if performance_tracker:
        insights = await performance_tracker.get_content_insights()

        response = """
üí° <b>–ë–´–°–¢–†–´–ï –ò–ù–°–ê–ô–¢–´</b>

"""
        if insights.get('recommendations'):
            response += "üéØ <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>\n"
            for rec in insights['recommendations'][:3]:
                response += f"‚Ä¢ {rec}\n"

        await message.answer(response, parse_mode="HTML")
    else:
        await message.answer("‚ö†Ô∏è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")